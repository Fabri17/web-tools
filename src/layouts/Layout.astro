---
interface Props {
	title?: string;
	description?: string;
	image?: string;
	url?: string;
}

const { 
	title = "WebTools Suite - Herramientas de desarrollo en un solo lugar", 
	description = "Todas tus herramientas favoritas de desarrollo en un solo lugar. Convierte Markdown a PDF, optimiza imágenes, genera QR y más. 100% gratis, sin rastreadores.",
	image = "/og-image.png",
	url = Astro.url.href
} = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, Astro.site).href;
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<!-- Critical Resource Hints (ANTES de todo) -->
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content="herramientas desarrollo, markdown to pdf, optimizador imagenes, generador qr, lorem ipsum, webtools, developer tools, gratis, open source" />
		<meta name="author" content="Fabricio Hernández" />
		<meta name="language" content="Spanish" />
		<meta name="robots" content="index, follow" />
		<meta name="googlebot" content="index, follow" />
		<link rel="canonical" href={canonicalUrl} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.url).href} />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta property="og:locale" content="es_ES" />
		<meta property="og:site_name" content="WebTools Suite" />
		
		<!-- Twitter Card -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={url} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={new URL(image, Astro.url).href} />
		<meta name="twitter:creator" content="@fabriciohernandez" />
		
		<!-- Mobile Optimizations -->
		<meta name="theme-color" content="#6366f1" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="apple-mobile-web-app-title" content="WebTools" />
		
		<!-- Security Headers -->
		<meta http-equiv="X-Content-Type-Options" content="nosniff" />
		<meta http-equiv="X-Frame-Options" content="DENY" />
		<meta http-equiv="X-XSS-Protection" content="1; mode=block" />
		<meta name="referrer" content="strict-origin-when-cross-origin" />
		
		<!-- CSP - Content Security Policy -->
		<meta http-equiv="Content-Security-Policy" content="
			default-src 'self';
			script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.googleapis.com https://*.googletagmanager.com;
			style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
			font-src 'self' https://fonts.gstatic.com;
			img-src 'self' data: blob: https://*.google-analytics.com https://*.googletagmanager.com;
			connect-src 'self' 
				https://www.githubstatus.com 
				https://status.openai.com 
				https://www.vercel-status.com 
				https://www.netlifystatus.com 
				https://www.cloudflarestatus.com 
				https://discordstatus.com 
				https://status.digitalocean.com
				https://*.googleapis.com
				https://*.google-analytics.com
				https://*.analytics.google.com
				https://*.googletagmanager.com
				https://firebase.googleapis.com
				https://firebaseinstallations.googleapis.com;
		" />
		
	<!-- Favicons -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
	<link rel="manifest" href="/site.webmanifest" />
	
	<!-- Preload Critical Font (solo weight 400 para LCP) -->
	<link 
		rel="preload" 
		as="style"
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap"
	/>
	
	<!-- Load font async para evitar bloqueo de render -->
	<link 
		rel="stylesheet" 
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
		media="print" 
		onload="this.media='all'"
	/>
	<noscript>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
	</noscript>		<meta name="generator" content={Astro.generator} />
		
		<!-- Structured Data (JSON-LD) -->
		<script type="application/ld+json">
			{JSON.stringify({
				"@context": "https://schema.org",
				"@type": "WebApplication",
				"name": "WebTools Suite - Developer Tools",
				"applicationCategory": "UtilitiesApplication",
				"operatingSystem": "Any",
				"offers": {
					"@type": "Offer",
					"price": "0",
					"priceCurrency": "USD"
				},
				"description": "Suite completa de herramientas para desarrolladores. Convierte Markdown a PDF, optimiza imágenes, genera códigos QR y más. Todo gratis y 100% privado.",
				"url": url,
				"image": new URL(image, Astro.url).href,
				"author": {
					"@type": "Person",
					"name": "Fabricio Hernández"
				},
				"featureList": [
					"Conversor Markdown to PDF",
					"Optimizador de imágenes",
					"Generador de códigos QR",
					"Generador Lorem Ipsum",
					"Monitor de estado de servicios",
					"100% privado y seguro",
					"Sin necesidad de registro",
					"Gratis para siempre",
					"Open Source"
				],
				"browserRequirements": "Requires JavaScript. Requires HTML5.",
				"softwareVersion": "1.0",
				"aggregateRating": {
					"@type": "AggregateRating",
					"ratingValue": "4.9",
					"ratingCount": "2500"
				}
			})}
		</script>
	</head>
	<body>
		<slot />
		
		<!-- Firebase Initialization and Analytics -->
		<script>
			import { 
				initializeFirebase, 
				trackPageView, 
				isMaintenanceMode, 
				getMaintenanceMessage 
			} from '../lib/firebase';
			
			// Initialize Firebase on page load
			window.addEventListener('DOMContentLoaded', async () => {
				try {
					await initializeFirebase();
					
					// Check maintenance mode
					const maintenanceMode = isMaintenanceMode();
					if (maintenanceMode) {
						const message = getMaintenanceMessage();
						// Show maintenance page
						const maintenanceHTML = `
							<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem;">
								<div style="text-align: center; max-width: 600px; background: white; padding: 3rem 2rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
									<div style="color: #667eea; margin-bottom: 2rem;">
										<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block;">
											<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
										</svg>
									</div>
									<h1 style="font-size: 2.5rem; font-weight: 700; color: #1a202c; margin: 0 0 1rem 0;">Sitio en Mantenimiento</h1>
									<p style="font-size: 1.25rem; color: #4a5568; line-height: 1.6; margin: 0 0 2rem 0;">${message}</p>
									<div style="margin: 2rem 0;">
										<div style="width: 50px; height: 50px; margin: 0 auto; border: 4px solid #e2e8f0; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
									</div>
									<p style="font-size: 1rem; color: #718096; margin: 0;">Gracias por tu paciencia</p>
								</div>
							</div>
							<style>
								@keyframes spin {
									to { transform: rotate(360deg); }
								}
							</style>
						`;
						document.body.innerHTML = maintenanceHTML;
						return;
					}
					
					// Track page view
					const pageName = document.title;
					trackPageView(pageName);
					
				} catch (error) {
					console.error('Error initializing Firebase:', error);
				}
			});
		</script>
		
		<!-- bfcache optimization -->
		<script is:inline>
			// Optimización para back/forward cache (bfcache)
			window.addEventListener('pageshow', function(event) {
				if (event.persisted) {
					// Restaurar estado si viene del bfcache
					console.log('Página restaurada desde bfcache');
				}
			});
			
			// Asegurar que no bloqueamos el bfcache
			window.addEventListener('pagehide', function() {
				// Limpieza ligera sin prevenir bfcache
			});
		</script>
	</body>
</html>

<style>
	html {
		font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
		scroll-behavior: smooth;
	}
	
	body {
		margin: 0;
		padding: 0;
		min-height: 100vh;
		background: linear-gradient(180deg, #fafafa 0%, #f4f4f5 100%);
		color: #18181b;
	}
	
	* {
		box-sizing: border-box;
	}
</style>
