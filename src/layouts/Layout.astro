---
import FavoritesBar from '../components/FavoritesBar.astro';

interface Props {
	title?: string;
	description?: string;
	image?: string;
	url?: string;
}

const { 
	title = "WebTools Suite - Tu caja de herramientas de desarrollo, sin rastreadores y sin complicaciones", 
	description = "Hecho por devs, para devs. Convierte Markdown a PDF, optimiza imágenes, genera datos falsos y más. Todo local, 100% privado, sin registro ni complicaciones.",
	image = "/og-image.png",
	url = Astro.url.href
} = Astro.props;

const canonicalUrl = new URL(Astro.url.pathname, Astro.site).href;
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<!-- Critical Resource Hints (ANTES de todo) -->
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content="herramientas desarrollo, markdown to pdf, optimizador imagenes, generador qr, lorem ipsum, webtools, developer tools, gratis" />
		<meta name="author" content="Fabricio Hernández" />
		<meta name="language" content="Spanish" />
		<meta name="robots" content="index, follow" />
		<meta name="googlebot" content="index, follow" />
		<link rel="canonical" href={canonicalUrl} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.url).href} />
		<meta property="og:image:width" content="1200" />
		<meta property="og:image:height" content="630" />
		<meta property="og:locale" content="es_ES" />
		<meta property="og:site_name" content="WebTools Suite" />
		
		<!-- Twitter Card -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={url} />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={new URL(image, Astro.url).href} />
		<meta name="twitter:creator" content="@fabriciohernandez" />
		
		<!-- Mobile Optimizations -->
		<meta name="theme-color" content="#6366f1" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="apple-mobile-web-app-title" content="WebTools" />
		
		<!-- Security Headers -->
		<meta http-equiv="X-Content-Type-Options" content="nosniff" />
		<meta http-equiv="X-Frame-Options" content="DENY" />
		<meta http-equiv="X-XSS-Protection" content="1; mode=block" />
		<meta name="referrer" content="strict-origin-when-cross-origin" />
		
		<!-- AdSense Configuration - ACTIVO PARA VERIFICACIÓN DURANTE REVISIÓN -->
		<meta name="google-adsense-account" content="ca-pub-8126867540323247" />
		<meta name="ads.txt" content="/ads.txt" />
		
		<!-- AdSense Script - DESHABILITADO DURANTE REVISIÓN (no mostrar anuncios aún) -->
		<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8126867540323247" crossorigin="anonymous"></script> -->
		
		<!-- CSP - Content Security Policy - CONFIGURADO PARA REVISIÓN DE ADSENSE -->
		<meta http-equiv="Content-Security-Policy" content="
			default-src 'self';
			script-src 'self' 'unsafe-inline' 'unsafe-eval' 
				https://*.googleapis.com 
				https://*.googletagmanager.com
				https://pagead2.googlesyndication.com
				https://tpc.googlesyndication.com
				https://www.googletagservices.com;
			style-src 'self' 'unsafe-inline' 
				https://fonts.googleapis.com
				https://pagead2.googlesyndication.com;
			font-src 'self' https://fonts.gstatic.com;
			img-src 'self' data: blob: 
				https://*.google-analytics.com 
				https://*.googletagmanager.com
				https://pagead2.googlesyndication.com
				https://tpc.googlesyndication.com
				https://*.googleusercontent.com;
			frame-src 'self'
				https://tpc.googlesyndication.com
				https://googleads.g.doubleclick.net;
			connect-src 'self' 
				https://www.githubstatus.com 
				https://status.openai.com 
				https://www.vercel-status.com 
				https://www.netlifystatus.com 
				https://www.cloudflarestatus.com 
				https://discordstatus.com 
				https://status.digitalocean.com
				https://*.googleapis.com
				https://*.google-analytics.com
				https://*.analytics.google.com
				https://*.googletagmanager.com
				https://firebase.googleapis.com
				https://firebaseinstallations.googleapis.com
				https://pagead2.googlesyndication.com
				https://v2.jokeapi.dev;
		" />
		
	<!-- Favicons -->
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
	<link rel="manifest" href="/site.webmanifest" />
	
	<!-- Preload Critical Fonts (Inter + JetBrains Mono) -->
	<link 
		rel="preload" 
		as="style"
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
	/>
	
	<!-- Load fonts async para evitar bloqueo de render -->
	<link 
		rel="stylesheet" 
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
		media="print" 
		onload="this.media='all'"
	/>
	<noscript>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" />
	</noscript>		<meta name="generator" content={Astro.generator} />
		
		<!-- Structured Data (JSON-LD) -->
		<script type="application/ld+json">
			{JSON.stringify({
				"@context": "https://schema.org",
				"@type": "WebApplication",
				"name": "WebTools Suite - Developer Tools",
				"applicationCategory": "UtilitiesApplication",
				"operatingSystem": "Any",
				"offers": {
					"@type": "Offer",
					"price": "0",
					"priceCurrency": "USD"
				},
				"description": "Suite completa de herramientas para desarrolladores. Convierte Markdown a PDF, optimiza imágenes, genera códigos QR y más. Todo gratis y 100% privado.",
				"url": url,
				"image": new URL(image, Astro.url).href,
				"author": {
					"@type": "Person",
					"name": "Fabricio Hernández"
				},
				"featureList": [
					"Conversor Markdown to PDF",
					"Optimizador de imágenes",
					"Generador de códigos QR",
					"Generador Lorem Ipsum",
					"Monitor de estado de servicios",
					"100% privado y seguro",
					"Sin necesidad de registro",
					"Gratis para siempre",
				],
				"browserRequirements": "Requires JavaScript. Requires HTML5.",
				"softwareVersion": "1.0",
				"aggregateRating": {
					"@type": "AggregateRating",
					"ratingValue": "4.9",
					"ratingCount": "2500"
				}
			})}
		</script>
	</head>
	<body>
		<!-- Favorites Bar - Acceso rápido a herramientas favoritas -->
		<FavoritesBar />
		
		<slot />
		
		<!-- Firebase Initialization and Analytics -->
		<script>
			import { 
				initializeFirebase, 
				trackPageView, 
				isMaintenanceMode, 
				getMaintenanceMessage 
			} from '../lib/firebase';
			
			// Initialize Firebase on page load
			window.addEventListener('DOMContentLoaded', async () => {
				try {
					await initializeFirebase();
					
					// Check maintenance mode
					const maintenanceMode = isMaintenanceMode();
					if (maintenanceMode) {
						const message = getMaintenanceMessage();
						// Show maintenance page
						const maintenanceHTML = `
							<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem;">
								<div style="text-align: center; max-width: 600px; background: white; padding: 3rem 2rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
									<div style="color: #667eea; margin-bottom: 2rem;">
										<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block;">
											<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
										</svg>
									</div>
									<h1 style="font-size: 2.5rem; font-weight: 700; color: #1a202c; margin: 0 0 1rem 0;">Sitio en Mantenimiento</h1>
									<p style="font-size: 1.25rem; color: #4a5568; line-height: 1.6; margin: 0 0 2rem 0;">${message}</p>
									<div style="margin: 2rem 0;">
										<div style="width: 50px; height: 50px; margin: 0 auto; border: 4px solid #e2e8f0; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
									</div>
									<p style="font-size: 1rem; color: #718096; margin: 0;">Gracias por tu paciencia</p>
								</div>
							</div>
							<style>
								@keyframes spin {
									to { transform: rotate(360deg); }
								}
							</style>
						`;
						document.body.innerHTML = maintenanceHTML;
						return;
					}
					
					// Track page view
					const pageName = document.title;
					trackPageView(pageName);
					
				} catch (error) {
					console.error('Error initializing Firebase:', error);
				}
			});
		</script>
		
		<!-- bfcache optimization -->
		<script is:inline>
			// Optimización para back/forward cache (bfcache)
			window.addEventListener('pageshow', function(event) {
				if (event.persisted) {
					// Restaurar estado si viene del bfcache
					console.log('Página restaurada desde bfcache');
				}
			});
			
			// Asegurar que no bloqueamos el bfcache
			window.addEventListener('pagehide', function() {
				// Limpieza ligera sin prevenir bfcache
			});
		</script>
	</body>
</html>

<style is:global>
	/* ==========================================
	   WEBTOOLS SUITE - DESIGN SYSTEM
	   Hecho por devs, para devs
	   ========================================== */
	
	:root {
		/* === BRAND COLORS === */
		/* Primary: Indigo/Purple */
		--color-primary: #6366f1;
		--color-primary-hover: #4f46e5;
		--color-primary-light: #818cf8;
		--color-primary-dark: #4338ca;
		
		/* Secondary: Purple/Violet */
		--color-secondary: #a855f7; /* Violet */
		--color-secondary-hover: #9333ea;
		--color-accent: #8b5cf6; /* Purple accent */
		--color-accent-hover: #7c3aed;
		
		/* Neutrals: Technical Black & Whites */
		--color-black: #0a0a0a;
		--color-gray-900: #121212;
		--color-gray-800: #1e1e1e;
		--color-gray-700: #2a2a2a;
		--color-gray-600: #3d3d3d;
		--color-gray-500: #6b6b6b;
		--color-gray-400: #9b9b9b;
		--color-gray-300: #c4c4c4;
		--color-gray-200: #e0e0e0;
		--color-gray-100: #f5f5f5;
		--color-white: #ffffff;
		
		/* === SEMANTIC COLORS === */
		--color-success: #10b981;
		--color-warning: #f59e0b;
		--color-error: #ef4444;
		--color-info: #3b82f6;
		
		/* === TYPOGRAPHY === */
		--font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
		--font-mono: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
		
		/* Font Sizes (Fluid Typography) */
		--text-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
		--text-sm: clamp(0.875rem, 0.825rem + 0.25vw, 1rem);
		--text-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
		--text-lg: clamp(1.125rem, 1.05rem + 0.375vw, 1.25rem);
		--text-xl: clamp(1.25rem, 1.15rem + 0.5vw, 1.5rem);
		--text-2xl: clamp(1.5rem, 1.35rem + 0.75vw, 1.875rem);
		--text-3xl: clamp(1.875rem, 1.65rem + 1.125vw, 2.25rem);
		--text-4xl: clamp(2.25rem, 1.95rem + 1.5vw, 3rem);
		--text-5xl: clamp(3rem, 2.5rem + 2.5vw, 4rem);
		
		/* Line Heights */
		--leading-none: 1;
		--leading-tight: 1.25;
		--leading-snug: 1.375;
		--leading-normal: 1.5;
		--leading-relaxed: 1.625;
		--leading-loose: 2;
		
		/* === SPACING === */
		--space-xs: 0.25rem;
		--space-sm: 0.5rem;
		--space-md: 1rem;
		--space-lg: 1.5rem;
		--space-xl: 2rem;
		--space-2xl: 3rem;
		--space-3xl: 4rem;
		--space-4xl: 6rem;
		
		/* === BORDERS & RADIUS === */
		--radius-sm: 0.375rem;
		--radius-md: 0.5rem;
		--radius-lg: 0.75rem;
		--radius-xl: 1rem;
		--radius-2xl: 1.5rem;
		--radius-full: 9999px;
		
		/* === SHADOWS === */
		--shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
		--shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
		--shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
		--shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
		--shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
		
		/* === TRANSITIONS === */
		--transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
		--transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
		--transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
		
		/* === LIGHT MODE THEME === */
		--bg-primary: var(--color-white);
		--bg-secondary: var(--color-gray-100);
		--bg-tertiary: var(--color-gray-200);
		--bg-gradient: linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);
		
		--text-primary: var(--color-gray-900);
		--text-secondary: var(--color-gray-600);
		--text-tertiary: var(--color-gray-500);
		
		--border-color: var(--color-gray-200);
		--border-hover: var(--color-gray-300);
	}
	
	/* === DARK MODE === */
	.dark-mode {
		color-scheme: dark;
		
		/* Dark Mode Colors */
		--bg-primary: var(--color-gray-900);
		--bg-secondary: var(--color-gray-800);
		--bg-tertiary: var(--color-gray-700);
		--bg-gradient: linear-gradient(180deg, #0a0a0a 0%, #121212 100%);
		
		--text-primary: var(--color-gray-100);
		--text-secondary: var(--color-gray-400);
		--text-tertiary: var(--color-gray-500);
		
		--border-color: var(--color-gray-700);
		--border-hover: var(--color-gray-600);
		
		/* Adjust shadows for dark mode */
		--shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
		--shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
		--shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5);
		--shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.6);
		--shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.7);
	}
	
	/* === BASE RESETS === */
	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}
	
	html {
		font-family: var(--font-sans);
		font-size: 16px;
		scroll-behavior: smooth;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		text-rendering: optimizeLegibility;
	}
	
	body {
		min-height: 100vh;
		background: var(--bg-gradient);
		color: var(--text-primary);
		overflow-x: hidden;
		line-height: var(--leading-normal);
	}
	
	/* === TYPOGRAPHY UTILITIES === */
	code, pre, kbd, samp {
		font-family: var(--font-mono);
	}
	
	h1, h2, h3, h4, h5, h6 {
		font-weight: 700;
		line-height: var(--leading-tight);
		color: var(--text-primary);
	}
	
	p {
		color: var(--text-secondary);
	}
	
	/* === UTILITY CLASSES === */
	.font-mono { font-family: var(--font-mono); }
	.font-sans { font-family: var(--font-sans); }
	
	.text-primary { color: var(--text-primary); }
	.text-secondary { color: var(--text-secondary); }
	.text-tertiary { color: var(--text-tertiary); }
	
	.bg-primary { background: var(--bg-primary); }
	.bg-secondary { background: var(--bg-secondary); }
	
	/* === FOCUS STATES === */
	:focus-visible {
		outline: 2px solid var(--color-primary);
		outline-offset: 2px;
	}
	
	/* === SELECTION === */
	::selection {
		background-color: var(--color-primary);
		color: var(--color-white);
	}
	
	::-moz-selection {
		background-color: var(--color-primary);
		color: var(--color-white);
	}
	
	/* === TOAST NOTIFICATIONS === */
	.favorites-toast {
		position: fixed;
		bottom: 2rem;
		left: 50%;
		transform: translateX(-50%) translateY(100px);
		background: white;
		color: #18181b;
		padding: 1rem 1.5rem;
		border-radius: 12px;
		box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
		font-size: 0.875rem;
		font-weight: 600;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		z-index: 9999;
		opacity: 0;
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		pointer-events: none;
		border: 1px solid #e4e4e7;
	}
	
	.favorites-toast.show {
		opacity: 1;
		transform: translateX(-50%) translateY(0);
	}
	
	.favorites-toast .toast-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 20px;
		height: 20px;
		border-radius: 50%;
		font-size: 0.75rem;
	}
	
	.favorites-toast-success {
		border-left: 4px solid #10b981;
	}
	
	.favorites-toast-success .toast-icon {
		background: #d1fae5;
		color: #059669;
	}
	
	.favorites-toast-warning {
		border-left: 4px solid #f59e0b;
	}
	
	.favorites-toast-warning .toast-icon {
		background: #fef3c7;
		color: #d97706;
	}
	
	.favorites-toast-error {
		border-left: 4px solid #ef4444;
	}
	
	.favorites-toast-error .toast-icon {
		background: #fee2e2;
		color: #dc2626;
	}
	
	/* Dark Mode Toast */
	.dark-mode .favorites-toast {
		background: #1e293b;
		color: #f8fafc;
		border-color: #334155;
		box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
	}
	
	.dark-mode .favorites-toast-success .toast-icon {
		background: rgba(16, 185, 129, 0.2);
		color: #34d399;
	}
	
	.dark-mode .favorites-toast-warning .toast-icon {
		background: rgba(245, 158, 11, 0.2);
		color: #fbbf24;
	}
	
	.dark-mode .favorites-toast-error .toast-icon {
		background: rgba(239, 68, 68, 0.2);
		color: #f87171;
	}
	
	/* Responsive Toast */
	@media (max-width: 640px) {
		.favorites-toast {
			bottom: 1rem;
			left: 1rem;
			right: 1rem;
			transform: translateX(0) translateY(100px);
		}
		
		.favorites-toast.show {
			transform: translateX(0) translateY(0);
		}
	}
</style>
